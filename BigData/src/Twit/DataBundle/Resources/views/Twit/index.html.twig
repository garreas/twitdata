{% extends ":default:layout.html.twig" %}
{% block form %}
    {{ form_start(form) }}
    {{ form_widget(form) }}
    {{ form_end(form) }}
{% endblock %}
{% block twit %}
    {% if twits is empty %}
        {% if post == 'POST' %}
            <h2 xmlns="http://www.w3.org/1999/html">Aucun top tweets</h2>
        {% endif %}
    {% else %}
        <h2>Top Tweet(s) last 24 hours</h2>
        {% set count = 0 %}
        {% for twit in twits %}
            <section style="background-color: #C4F9FF; float: left; border-radius: 7px; padding: 3%; width: 95%; margin: 1%; position: relative;">
                <img src="https://g.twimg.com/Twitter_logo_blue.png" width="3%" height="3%"/>
                <a href="http://twitter.com/{{ twit.user }}">{{ twit.user }}</a>
                <p>{{ twit.contents }}</p>
                <p>{{ twit.createAt|date('Y-m-d') }}</p>
                <p>{{ twit.location }}</p>
                {% if sentiments[count]['status'] == 'OK' %}
                    <p>Tweet sentiment: {{ sentiments[count]['docSentiment']['type'] }}</p>
                {% endif %}
            </section>
            {% set count = count + 1 %}
        {% endfor %}
    {% endif %}
{% endblock %}
{% block render %}
    {% if twits is not empty %}
        <script>
            $(function(){
                $("#doughnutChart").drawDoughnutChart([
                    { title: "Tweets count", value : {{ twits|length}},  color: "#C4F9FF" }
                ]);
            });
        </script>
        <h2 id="scroll" href="#">Sentiment Analysis Report</h2>
        <section style="background-color: #D5D5D5; float: left; border-radius: 7px; padding: 3%; width: 95%; margin: 1%; position: relative; height: 500px;">
            <section style="position: relative; width: 33%; margin-left: 58%; margin-top: 17%;">
                <div id="doughnutChart" class="chart"></div>
            </section>
        {% set type_pos = 0 %}
        {% set type_net = 0 %}
        {% set type_neg = 0 %}
        {% for sent in sentiments %}
            {% if sent['status'] == 'OK' %}
                {% if sent['docSentiment']['type'] == 'positive' %}
                    {% set type_pos = type_pos + 1 %}
                {% elseif sent['docSentiment']['type'] == 'neutral' %}
                    {% set type_net = type_net + 1 %}
                {% elseif sent['docSentiment']['type'] == 'negative' %}
                    {% set type_neg = type_neg + 1 %}
                {% endif %}
            {% endif %}
        {% endfor %}
        <script>
                $(function(){
                $("#pos").drawDoughnutChart([
                { title: "Tweets Positifs", value : {{ type_pos }},  color: "green" }
                ]);
                });
                $(function(){
                $("#net").drawDoughnutChart([
                { title: "Tweets Neutres", value : {{ type_net }},  color: "yellow" }
                ]);
                });
                $(function(){
                $("#neg").drawDoughnutChart([
                { title: "Tweets Negatifs", value : {{ type_neg }},  color: "red" }
                ]);
                });
        </script>
        <section style="position: relative; width: 33%; margin-left: 26%; margin-top: 45%;">
            <div id="pos" class="chart"></div>
        </section>
            <section style="position: relative; width: 33%; margin-top: 74%; margin-left: 57%;">
                <div id="net" class="chart"></div>
            </section>
            <section style="position: relative; width: 33%; margin-top: -28%; margin-left: 90%;">
                <div id="neg" class="chart"></div>
            </section>
        </section>
    {% endif %}
{% endblock %}